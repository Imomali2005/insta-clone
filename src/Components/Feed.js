// Below are some mecessary imports
import React, {useContext,useEffect, useState} from 'react'
import { AuthContext } from '../Context/AuthContext'
import { database } from '../firebase';
import Posts from './Posts';
import Navbar from './Navbar'

import UploadFile from './UploadFile'

// This is our main feed component
function Feed() {
  // we will import reference of user and logout from our global store
  const {user,logout} = useContext(AuthContext);
  // we have user data and set user data state, which will be used to store the information of the logged in user
  const [userData,setUserData] = useState('');
  useEffect(() => {
    // The uid is a random id generated by the Firebase server side system. 
    // That uid does not change once the account is created. 
    // When you delete an account, the uid is also deleted. 
    // The uid is how you want to identify your various users.

    // A DataSnapshot contains data from a Database location. 
    // Any time you read data from the Database, you receive the data as a DataSnapshot
    const unsub = database.users.doc(user.uid).onSnapshot((snapshot) => {
      setUserData(snapshot.data());
    })
    return () => {unsub()} // cleanup
    // Just like the name implies, the useEffect c
    // leanup is a function in the useEffect Hook that allows us to 
    // tidy up our code before our component unmounts. When our code runs and reruns for every render, 
    // useEffect also cleans up after itself using the cleanup function.
  },[user])
  return (
    <>
    {/* First component is snavbar which will be displayed */}
    <Navbar userData={userData}/>
    <div style={{display:'flex',justifyContent:'center',alignItems:'center',flexDirection:'column'}}>
    {/* <div className="comp" style={{width:'50%'}}>
        <h1>Welcome To Feeds</h1>
        <button onClick={logout}>Logout</button>
    </div> */}
    {/* Second componenet is upload file  */}
    <UploadFile user={userData} />
    {/* Third component is the posts */}
    <Posts userData={userData} />
    </div>

    </>
  )
}

export default Feed